<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--MemberMapper 등록-->
<mapper namespace="com.highfive.chajiserver.mapper.MapMapper">
    <!--    쿼리 작성-->
    <select id="getZscode" parameterType="ZscodeMappingDTO" resultType="String">
        SELECT zscode FROM zscode_mapping WHERE sigungu_name = #{sigunguName} AND zcode =#{zcode}
    </select>

    <select id="getAllZscode" resultType="String">
        select zscode from zscode_mapping
    </select>

    <insert id="insertOrUpdateStation" parameterType="com.highfive.chajiserver.dto.StationDTO">
        INSERT INTO all_stations (
            stat_id, chger_id, stat_nm, chger_type, addr, addr_detail, location,
            use_time, lat, lng, busi_id, bnm, busi_nm, busi_call, stat,
            stat_upd_dt, last_tsdt, last_tedt, now_tsdt, power_type, output,
            method, zcode, zscode, kind, kind_detail, parking_free, note,
            limit_yn, limit_detail, del_yn, del_detail, traffic_yn, year
        ) VALUES (
                     #{statId}, #{chgerId}, #{statNm}, #{chgerType}, #{addr}, #{addrDetail}, #{location},
                     #{useTime}, #{lat}, #{lng}, #{busiId}, #{bnm}, #{busiNm}, #{busiCall}, #{stat},
                     #{statUpdDt}, #{lastTsdt}, #{lastTedt}, #{nowTsdt}, #{powerType}, #{output},
                     #{method}, #{zcode}, #{zscode}, #{kind}, #{kindDetail}, #{parkingFree}, #{note},
                     #{limitYn}, #{limitDetail}, #{delYn}, #{delDetail}, #{trafficYn}, #{year}
                 )
            ON DUPLICATE KEY UPDATE
                                 stat_nm = VALUES(stat_nm),
                                 chger_type = VALUES(chger_type),
                                 addr = VALUES(addr),
                                 addr_detail = VALUES(addr_detail),
                                 location = VALUES(location),
                                 use_time = VALUES(use_time),
                                 lat = VALUES(lat),
                                 lng = VALUES(lng),
                                 busi_id = VALUES(busi_id),
                                 bnm = VALUES(bnm),
                                 busi_nm = VALUES(busi_nm),
                                 busi_call = VALUES(busi_call),
                                 stat = VALUES(stat),
                                 stat_upd_dt = VALUES(stat_upd_dt),
                                 last_tsdt = VALUES(last_tsdt),
                                 last_tedt = VALUES(last_tedt),
                                 now_tsdt = VALUES(now_tsdt),
                                 power_type = VALUES(power_type),
                                 output = VALUES(output),
                                 method = VALUES(method),
                                 zcode = VALUES(zcode),
                                 zscode = VALUES(zscode),
                                 kind = VALUES(kind),
                                 kind_detail = VALUES(kind_detail),
                                 parking_free = VALUES(parking_free),
                                 note = VALUES(note),
                                 limit_yn = VALUES(limit_yn),
                                 limit_detail = VALUES(limit_detail),
                                 del_yn = VALUES(del_yn),
                                 del_detail = VALUES(del_detail),
                                 traffic_yn = VALUES(traffic_yn),
                                 year = VALUES(year)
    </insert>

    <select id="getAllStationsFromDB" resultType="com.highfive.chajiserver.dto.StationDTO">
        select * from all_stations
    </select>

    <select id="getSigunguMap" resultType="map">
        SELECT zscode AS `key`, sigungu_name AS `value`
        FROM zscode_mapping
    </select>

    <!-- ✅ 시군구 이름 + 대표 좌표 (AVG lat/lon) -->
    <select id="getSigunguMapWithCoord" resultType="map">
        SELECT
            zs.zscode AS `key`,
            zm.sigungu_name AS `value`,
            AVG(zs.lat) AS lat,
            AVG(zs.lng) AS lng
        FROM all_stations zs
                 JOIN zscode_mapping zm ON zs.zscode = zm.zscode
        GROUP BY zs.zscode, zm.sigungu_name
    </select>

    <!-- ✅ 시도 이름 전용 (key: zcode, value: 시도명) -->
    <select id="getSidoMap" resultType="map">
        SELECT DISTINCT
            zcode AS `key`,
            CASE zcode
                WHEN '11' THEN '서울특별시'
                WHEN '26' THEN '부산광역시'
                WHEN '27' THEN '대구광역시'
                WHEN '28' THEN '인천광역시'
                WHEN '29' THEN '광주광역시'
                WHEN '30' THEN '대전광역시'
                WHEN '31' THEN '울산광역시'
                WHEN '36' THEN '세종특별자치시'
                WHEN '41' THEN '경기도'
                WHEN '51' THEN '강원도'
                WHEN '43' THEN '충청북도'
                WHEN '44' THEN '충청남도'
                WHEN '52' THEN '전라북도'
                WHEN '46' THEN '전라남도'
                WHEN '47' THEN '경상북도'
                WHEN '48' THEN '경상남도'
                WHEN '50' THEN '제주특별자치도'
                ELSE '기타'
                END AS `value`
        FROM all_stations
        WHERE zcode IS NOT NULL
    </select>

    <!-- ✅ 시도 이름 + 대표 좌표 (AVG lat/lon 포함) -->
    <select id="getSidoMapWithCoord" resultType="map">
        SELECT
            zcode AS `key`,
            CASE zcode
                WHEN '11' THEN '서울특별시'
                WHEN '26' THEN '부산광역시'
                WHEN '27' THEN '대구광역시'
                WHEN '28' THEN '인천광역시'
                WHEN '29' THEN '광주광역시'
                WHEN '30' THEN '대전광역시'
                WHEN '31' THEN '울산광역시'
                WHEN '36' THEN '세종특별자치시'
                WHEN '41' THEN '경기도'
                WHEN '51' THEN '강원도'
                WHEN '43' THEN '충청북도'
                WHEN '44' THEN '충청남도'
                WHEN '52' THEN '전라북도'
                WHEN '46' THEN '전라남도'
                WHEN '47' THEN '경상북도'
                WHEN '48' THEN '경상남도'
                WHEN '50' THEN '제주특별자치도'
                ELSE '기타'
                END AS `value`,
            AVG(lat) AS lat,
            AVG(lng) AS lng
        FROM all_stations
        WHERE zcode IS NOT NULL
        GROUP BY zcode
    </select>
</mapper>